<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>PHIẾU GỬI HÀNG</title>
  <style>
    @page {
      size: A6 portrait;
      margin: 5mm;
    }

    body {
      font-family: 'Times New Roman', serif;
      font-size: 11px;
      background-color: white;
      padding: 0;
      margin: 0;
    }

    .container {
      width: 100%;
      box-sizing: border-box;
      padding: 5mm;
    }

    .barcode {
      text-align: center;
      margin-bottom: 5px;
    }

    .barcode img {
      max-width: 100%;
      height: auto;
    }

    .info-table, .item-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 4px;
      margin-bottom: 4px;
    }

    .info-table td {
      vertical-align: top;
      padding: 2px;
    }

    .bold {
      font-weight: bold;
    }

    .boxed {
      border: 1px solid black;
      padding: 2px;
    }

    .item-table td {
      border: 1px solid black;
      padding: 2px 4px;
    }

    .item-table th {
      border: 1px solid black;
      padding: 2px 4px;
      text-align: left;
      font-weight: normal;
    }

    .footer {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-top: 8px;
    }

    .footer-left {
      width: 35%;
      text-align: center;
    }

    .footer-left img {
      max-width: 100%;
      height: auto;
    }

    .footer-right {
      width: 60%;
      text-align: center;
    }

    #qr {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border: 1px solid #000;
      display: inline-block;
    }
  </style>
  <script>
    function getParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name) || "";
    }

    window.onload = function () {
      const mapping = {
        "mvd": "mvd",
        "sdt": "sdt",
        "cod": "cod",
        "cuoc": "cuoc",
        "dongkiem": "dongkiem",
        "freeship": "freeship",
        "ghichu": "ghichu"
      };

      for (const key in mapping) {
        const value = getParam(key);
        document.getElementById(mapping[key]).innerText = value;
      }

      const itemsRaw = getParam("items"); // e.g. "2 Dép_a_1 Găng_b_4 Chổi"
      if (itemsRaw) {
        const rows = itemsRaw.split("_");
        const colA = [];
        const colB = [];
        for (let i = 0; i < rows.length; i++) {
          const val = rows[i];
          if (val === "a") continue;
          if (val === "b") continue;
          if (i > 0 && rows[i - 1] === "a") {
            colA.push(val);
          } else if (i > 0 && rows[i - 1] === "b") {
            colB.push(val);
          }
        }
        document.getElementById("colA").innerHTML = colA.map(item => `<div>${item}</div>`).join("");
        document.getElementById("colB").innerHTML = colB.map(item => `<div>${item}</div>`).join("");
      }

      const barcode = getParam("barcode");
      const qr = getParam("qr");
      const logo = getParam("logo");

      if (barcode) document.getElementById("barcode").src = barcode;
      if (qr) document.getElementById("qr").src = qr;
      if (logo) document.getElementById("logo").src = logo;

      setTimeout(() => window.print(), 1500);
    };
  </script>
</head>
<body>
  <div class="container">
    <div class="barcode">
      <img id="barcode" src="" alt="Barcode">
    </div>

    <table class="info-table">
      <tr>
        <td><span class="bold">MVĐ:</span></td>
        <td class="boxed" id="mvd"></td>
      </tr>
      <tr>
        <td colspan="2"><span class="bold">Gửi:</span></td>
      </tr>
      <tr>
        <td colspan="2">Người Nhận: Tên<br>Địa Chỉ:</td>
      </tr>
      <tr>
        <td colspan="2">SDT: <span id="sdt"></span></td>
      </tr>
    </table>

    <table class="info-table">
      <tr>
        <td class="bold">COD:</td>
        <td id="cod"></td>
        <td class="bold">Cước:</td>
        <td id="cuoc"></td>
      </tr>
      <tr>
        <td colspan="2" class="bold">0/Được đồng kiểm</td>
        <td class="bold">Free Ship:</td>
        <td id="freeship"></td>
      </tr>
    </table>

    <table class="item-table">
      <tr>
        <th colspan="2">Hàng Hóa</th>
      </tr>
      <tr>
        <td id="colA"></td>
        <td id="colB"></td>
      </tr>
    </table>

    <div><strong>Ghi chú:</strong> <span id="ghichu"></span></div>

    <div class="footer">
      <div class="footer-left">
        <img id="logo" src="" alt="Logo">
        <div>Ship Đến Ngay<br><strong>035.3873.488</strong></div>
      </div>
      <div class="footer-right">
        <img id="qr" src="" alt="QR Code">
      </div>
    </div>
  </div>
</body>
</html>
