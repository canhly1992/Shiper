<script>
  const params = new URLSearchParams(window.location.search);

  function setValue(id) {
    const el = document.getElementById(id);
    if (el) el.textContent = params.get(id) ? decodeURIComponent(params.get(id)) : "";
  }

  const fields = [
    "madh","tencty","diachicty","lienhe","dienthoai",
    "mahang","somay","loaidv","batdau","ketthuc",
    "tongquat","mota","sohieu","hangsx",
    "khoangcach","tinhtrang","dichvu","ghichu","kySu"
  ];
  fields.forEach(setValue);

  // 🌟 ĐỔI TIÊU ĐỀ TRANG = "Tên công ty - Mã số"
  const tencty = params.get("tencty") ? decodeURIComponent(params.get("tencty")) : "";
  const madh = params.get("madh") ? decodeURIComponent(params.get("madh")) : "";
  if (tencty || madh) {
    document.title = `${tencty}${tencty && madh ? " - " : ""}${madh}`;
  }

  // HIỂN THỊ HÌNH ẢNH
  const imgContainer = document.getElementById("images-page");
  for (let i = 1; i <= 9; i++) {
    const file = params.get("anh" + i);
    if (file) {
      const fullUrl = `https://www.appsheet.com/template/gettablefileurl?appName=Qu%E1%BA%A3nl%C3%BDd%E1%BB%8Bchv%E1%BB%A5-300959436&tableName=Th%C3%B4ng%20tin%20chung&fileName=${decodeURIComponent(file)}`;
      const wrapper = document.createElement("div");
      const img = document.createElement("img");
      img.src = fullUrl;
      img.alt = "Image " + i;
      wrapper.appendChild(img);
      const label = document.createElement("div");
      label.textContent = "Image " + i;
      wrapper.appendChild(label);
      imgContainer.appendChild(wrapper);
    }
  }

  // 🌟 TỰ LẤY EMAIL TỪ LINK
  const email = params.get("email") ? decodeURIComponent(params.get("email")) : "";

  // 🌟 GỬI EMAIL — tự điền email và tiêu đề tiếng Việt
  function guiGmail() {
    const to = email || "";
    const subject = encodeURIComponent(`${tencty} - ${madh}`);
    const body = encodeURIComponent(
      `Kính gửi ${document.getElementById("lienhe").textContent || ""},\n\n` +
      `Đính kèm là báo cáo dịch vụ khách hàng của công ty ${tencty}.\n\n` +
      `Mã biên bản: ${madh}\n\n` +
      `Trân trọng,\nNew Technologies Scientific Corporation`
    );

    window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
  }
</script>
