<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>PHIẾU THU TIỀN 1</title>
  <style>
    @page { size: A4 portrait; margin: 12mm; }
    body {
      font-family: "Times New Roman", serif;
      font-size: 13px;
      margin: 0;
      padding: 0;
      color: #000;
    }
    .header {
      width: 100%;
      margin-bottom: 5px;
      font-size: 13px;
      line-height: 1.4;
    }
    .header p { margin: 0; }
    .title {
      text-align: center;
      font-weight: bold;
      font-size: 20px;
      margin: 10px 0;
      text-transform: uppercase;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    th, td {
      border: 1px solid #000;
      padding: 6px;
      text-align: center;
    }
    td.left { text-align: left; }
    td.right { text-align: right; }
    .total {
      font-weight: bold;
      background: #f5f5f5;
    }
    .highlight {
      background: yellow;
      color: red;
      font-weight: bold;
    }
    .sign-block {
      margin-top: 30px;
      font-size: 13px;
      width: 100%;
      display: flex;
      justify-content: space-between;
    }
    .sign-col {
      width: 45%;
      text-align: center;
    }
    .note {
      font-size: 12px;
      margin-top: 10px;
      color: red;
      font-style: italic;
    }
  </style>
</head>
<body>

  <div class="header">
    <p>122 Nơ, Từ Hoa, Quảng An, Tây Hồ.</p>
    <p>Contact: +84328.972.855 (Mr Long Management)</p>
    <p>Date: <span id="ngay"></span></p>
  </div>

  <div class="title">RECEIPTS ROOM <span id="maso"></span></div>

  <table>
    <tr>
      <td class="left"><b>Full Name:</b> <span id="hoten"></span></td>
      <td class="left"><b>Phone:</b> <span id="sdt"></span></td>
    </tr>
    <tr>
      <td colspan="2" class="left"><b>Address:</b> <span id="diachi"></span></td>
    </tr>
  </table>

  <table style="margin-top:12px;">
    <thead>
      <tr>
        <th>Item code</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody id="dichvu">
      <!-- các dịch vụ sẽ render ở đây -->
    </tbody>
    <tfoot>
      <tr class="total">
        <td class="right">TOTAL</td>
        <td class="right"><span id="tongtien"></span> VNĐ</td>
      </tr>
    </tfoot>
  </table>

  <p><b>The total amount payable:</b> <span style="color:red;" id="tongtien2"></span> VNĐ</p>

  <table>
    <tr>
      <td class="left" colspan="3">
        <b>Transfer Information:</b><br>
        NAME ACCOUNT: <span id="tenTk"></span><br>
        NUMBER ACCOUNT: <span id="soTk"></span><br>
        Bank Name: <span id="nganHang"></span><br>
        <b>Transfer Content:</b><br>
        <span id="noiDung" class="highlight"></span>
      </td>
      <td style="width:180px; text-align:center;">
        <img id="qrcode" style="width:150px; height:150px;">
      </td>
    </tr>
  </table>

  <p class="note">IMPORTANT: Using the correct content of the message if it is wrong, it will be considered as not collecting money yet - QUAN TRỌNG: Sử dụng đúng nội dung tin nhắn nếu sai coi như chưa thu tiền.</p>

  <div class="sign-block">
    <div class="sign-col">
      <b>Khách hàng</b><br>(Ký và ghi rõ họ tên)
    </div>
    <div class="sign-col">
      <b>Người thu tiền</b><br>(Ký và ghi rõ họ tên)
    </div>
  </div>

  <script>
    // Hàm lấy tham số từ URL
    function getParam(name) {
      return new URLSearchParams(window.location.search).get(name) || "";
    }

    // Ngày hiện tại
    const today = new Date();
    document.getElementById("ngay").innerText =
      String(today.getDate()).padStart(2,'0') + "/" +
      String(today.getMonth()+1).padStart(2,'0') + "/" +
      today.getFullYear();

    // Gán dữ liệu từ URL
    document.getElementById("hoten").innerText = getParam("hoten");
    document.getElementById("diachi").innerText = getParam("diachi");
    document.getElementById("maso").innerText = getParam("maso");
    document.getElementById("sdt").innerText = getParam("sdt");
    document.getElementById("tongtien").innerText = getParam("tongtien");
    document.getElementById("tongtien2").innerText = getParam("tongtien");

    document.getElementById("tenTk").innerText = getParam("tentaikhoan");
    document.getElementById("soTk").innerText = getParam("sotaikhoan");
    document.getElementById("nganHang").innerText = getParam("nganhang");

    // Nội dung chuyển khoản: dùng số phòng làm mã
    document.getElementById("noiDung").innerText = getParam("maso") + " TT BILL";

    // Danh sách dịch vụ (data)
    const data = getParam("data").split("_b_");
    let tbody = document.getElementById("dichvu");
    data.forEach(item => {
      if(item.trim() !== ""){
        let tr = document.createElement("tr");
        tr.innerHTML = `<td>${item}</td><td></td>`;
        tbody.appendChild(tr);
      }
    });

    // Sinh QR code
    const qrData = `BANK:${getParam("nganHang")}\nACC:${getParam("sotaikhoan")}\nND:${getParam("maso")} TT BILL\nTOTAL:${getParam("tongtien")} VND`;
    document.getElementById("qrcode").src =
      "https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=" + encodeURIComponent(qrData);
  </script>
</body>
</html>
