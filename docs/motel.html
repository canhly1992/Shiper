<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Phiếu thu tiền phòng</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .invoice-box {
      max-width: 900px;
      margin: auto;
      border: 1px solid #000;
      padding: 20px;
      font-size: 14px;
      line-height: 20px;
    }
    h2 { text-align: center; margin: 5px 0; }
    p { margin: 3px 0; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 14px;
    }
    table, th, td {
      border: 1px solid #000;
    }
    th, td {
      padding: 6px;
      text-align: center;
    }
    .summary {
      margin-top: 10px;
      text-align: right;
    }
    .qr-box {
      text-align: center;
      margin-top: 15px;
    }
    .footer {
      margin-top: 30px;
      display: flex;
      justify-content: space-between;
      font-size: 13px;
    }
    .footer .sign {
      text-align: center;
      width: 200px;
    }
  </style>
</head>
<body>
  <div class="invoice-box">
    <h2>PHIẾU THU TIỀN PHÒNG</h2>
    <p>Địa chỉ: 122 Nơ Trang Long, Bình Thạnh, TP.HCM</p>
    <p>Liên hệ: 0866.182.134 (Zalo/WhatsApp)</p>
    <p>Mã phiếu: <span id="maphieu"></span> &nbsp;|&nbsp; Ngày lập: <span id="ngaylap"></span></p>

    <p><strong>Mã phòng:</strong> <span id="maso"></span></p>
    <p><strong>Họ tên:</strong> <span id="hoten"></span></p>
    <p><strong>Tên TK:</strong> <span id="tentaikhoan"></span></p>
    <p><strong>Ngân hàng:</strong> <span id="nganhang"></span></p>
    <p><strong>Số điện thoại:</strong> <span id="sdt"></span></p>
    <p><strong>Số TK:</strong> <span id="sotaikhoan"></span></p>

    <!-- Dịch vụ khác -->
    <h3>Các dịch vụ khác</h3>
    <table>
      <tr>
        <th>Dịch vụ</th><th>Số lượng</th><th>Đơn giá</th><th>Thành tiền</th>
      </tr>
      <tr><td>Internet</td><td>1</td><td id="tieninternet"></td><td id="thanhtieninternet"></td></tr>
      <tr><td>Phí rác</td><td>1</td><td id="rac"></td><td id="thanhtienrac"></td></tr>
      <tr><td>Gửi xe</td><td id="soluongxe"></td><td id="phixe"></td><td id="tongphixe"></td></tr>
      <tr><td>Chi phí khác</td><td>1</td><td id="chiphipkhac"></td><td id="thanhtienkhac"></td></tr>
    </table>

    <!-- Tiền điện -->
    <h3>Tiền điện</h3>
    <table>
      <tr>
        <th>Dịch vụ</th><th>Chỉ số cũ</th><th>Chỉ số mới</th><th>Số lượng (kWh)</th><th>Đơn giá</th><th>Thành tiền</th>
      </tr>
      <tr>
        <td>Điện</td>
        <td id="sodiencu"></td>
        <td id="sodienmoi"></td>
        <td id="sodienluong"></td>
        <td id="giadien"></td>
        <td id="tongtiendien"></td>
      </tr>
    </table>

    <!-- Tiền nước -->
    <h3>Tiền nước</h3>
    <table>
      <tr>
        <th>Dịch vụ</th><th>Chỉ số cũ</th><th>Chỉ số mới</th><th>Số lượng (m³)</th><th>Đơn giá</th><th>Thành tiền</th>
      </tr>
      <tr>
        <td>Nước</td>
        <td id="sonuoccu"></td>
        <td id="sonuocmoi"></td>
        <td id="sonuocluong"></td>
        <td id="gianuoc"></td>
        <td id="tongtiennuoc"></td>
      </tr>
    </table>

    <!-- Tổng hợp -->
    <div class="summary">
      <p><strong>Tổng cộng:</strong> <span id="tongtien"></span> VND</p>
      <p><strong>Giảm giá:</strong> <span id="giagiam"></span> VND</p>
      <p><strong>Còn lại:</strong> <span id="conlai"></span> VND</p>
    </div>

    <!-- Thông tin CK -->
    <p><strong>Thông tin chuyển khoản:</strong></p>
    <p>Chủ tài khoản: <span id="tentaikhoan"></span></p>
    <p>Số tài khoản: <span id="sotaikhoan"></span></p>
    <p>Ngân hàng: <span id="nganhang"></span></p>
    <p>Nội dung CK: <span id="noidungck"></span></p>
    <p style="color:red">Lưu ý: Vui lòng nhập đúng nội dung CK. Sai nội dung = chưa thanh toán.</p>

    <div class="qr-box">
      <img id="vietqr" src="" alt="QR Thanh toán" width="200" height="200">
    </div>

    <div class="footer">
      <div></div>
      <div class="sign">
        <p>Ngày <span id="ngaylap2"></span></p>
        <p><em>Người lập phiếu</em></p>
        <br><br>
        <p><strong>Vũ Cao Long</strong></p>
      </div>
    </div>
  </div>

  <script>
    function getParam(param) {
      return new URLSearchParams(window.location.search).get(param) || "0";
    }

    function formatNumber(num) {
      return Number(num).toLocaleString("vi-VN");
    }

    // Ngày hiện tại
    const today = new Date();
    const dateStr = today.getDate()+"/"+(today.getMonth()+1)+"/"+today.getFullYear();
    document.getElementById("ngaylap").innerText = dateStr;
    document.getElementById("ngaylap2").innerText = dateStr;

    // Dữ liệu cơ bản
    ["maphieu","maso","hoten","tentaikhoan","nganhang","sdt","sotaikhoan","giagiam"].forEach(id=>{
      if(document.getElementById(id)) document.getElementById(id).innerText = getParam(id);
    });

    // Dịch vụ khác
    const tieninternet = Number(getParam("tieninternet"));
    document.getElementById("tieninternet").innerText = formatNumber(tieninternet);
    document.getElementById("thanhtieninternet").innerText = formatNumber(tieninternet);

    const rac = Number(getParam("rac"));
    document.getElementById("rac").innerText = formatNumber(rac);
    document.getElementById("thanhtienrac").innerText = formatNumber(rac);

    const soluongxe = Number(getParam("soluongxe"));
    const phixe = Number(getParam("phixe"));
    document.getElementById("soluongxe").innerText = soluongxe;
    document.getElementById("phixe").innerText = formatNumber(phixe);
    document.getElementById("tongphixe").innerText = formatNumber(soluongxe * phixe);

    const chiphipkhac = Number(getParam("chiphipkhac"));
    document.getElementById("chiphipkhac").innerText = formatNumber(chiphipkhac);
    document.getElementById("thanhtienkhac").innerText = formatNumber(chiphipkhac);

    // Điện
    const diencu = Number(getParam("sodiencu"));
    const dienmoi = Number(getParam("sodienmoi"));
    const giadien = Number(getParam("giadien"));
    const sodienluong = dienmoi - diencu;
    document.getElementById("sodiencu").innerText = diencu;
    document.getElementById("sodienmoi").innerText = dienmoi;
    document.getElementById("sodienluong").innerText = sodienluong;
    document.getElementById("giadien").innerText = formatNumber(giadien);
    document.getElementById("tongtiendien").innerText = formatNumber(sodienluong * giadien);

    // Nước
    const nuoccu = Number(getParam("sonuoccu"));
    const nuocmoi = Number(getParam("sonuocmoi"));
    const gianuoc = Number(getParam("gianuoc"));
    const sonuocluong = nuocmoi - nuoccu;
    document.getElementById("sonuoccu").innerText = nuoccu;
    document.getElementById("sonuocmoi").innerText = nuocmoi;
    document.getElementById("sonuocluong").innerText = sonuocluong;
    document.getElementById("gianuoc").innerText = formatNumber(gianuoc);
    document.getElementById("tongtiennuoc").innerText = formatNumber(sonuocluong * gianuoc);

    // Tổng cộng
    const tongtien = tieninternet + rac + (soluongxe * phixe) + chiphipkhac + (sodienluong * giadien) + (sonuocluong * gianuoc);
    document.getElementById("tongtien").innerText = formatNumber(tongtien);

    const giagiam = Number(getParam("giagiam"));
    const conlai = tongtien - giagiam;
    document.getElementById("conlai").innerText = formatNumber(conlai);

    // Nội dung CK
    const noidung = `TT phong ${getParam("maso")} - ${getParam("hoten")}`;
    document.getElementById("noidungck").innerText = noidung;

    // QR code
    const bank = getParam("nganhang");
    const account = getParam("sotaikhoan");
    const name = getParam("tentaikhoan");
    if (bank && account) {
      const qrUrl = `https://img.vietqr.io/image/${bank}-${account}-compact2.png?amount=${conlai}&addInfo=${encodeURIComponent(noidung)}&accountName=${encodeURIComponent(name)}`;
      document.getElementById("vietqr").src = qrUrl;
    }
  </script>
</body>
</html>
