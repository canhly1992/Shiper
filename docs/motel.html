<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>PHIẾU THU TIỀN</title>
  <style>
    @page { size: A5 portrait; margin: 8mm; }
    body {
      font-family: "Times New Roman", serif;
      font-size: 12px;
      margin: 0;
      padding: 0;
      color: #000;
    }
    .header {
      width: 100%;
      margin-bottom: 5px;
      font-size: 12px;
      line-height: 1.3;
    }
    .header p { margin: 0; }
    .title {
      text-align: center;
      font-weight: bold;
      font-size: 16px;
      margin: 4px 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    th, td {
      border: 1px solid #000;
      padding: 4px;
      text-align: center;
    }
    td.left { text-align: left; }
    td.right { text-align: right; }
    .total {
      font-weight: bold;
      background: #f5f5f5;
    }
    .highlight {
      background: yellow;
      color: red;
      font-weight: bold;
    }
    .sign-block {
      margin-top: 15px;
      font-size: 11px;
      width: 100%;
      display: flex;
      justify-content: space-between;
    }
    .sign-col {
      width: 45%;
      text-align: center;
    }
    .note {
      font-size: 11px;
      margin-top: 5px;
      color: red;
      font-style: italic;
    }
  </style>
</head>
<body>

  <div class="header">
    <p>122 Nơ, Từ Hoa, Quảng An, Tây Hồ.</p>
    <p>Contact: +84328.972.855 (Mr Long Management)</p>
    <p>Date: <span id="ngay"></span></p>
  </div>

  <div class="title">RECEIPTS ROOM 503</div>

  <table>
    <tr>
      <td class="left"><b>Full Name:</b> <span id="hoten"></span></td>
      <td class="left"><b>Phone:</b> <span id="sdt"></span></td>
    </tr>
    <tr>
      <td colspan="2" class="left"><b>Address:</b> <span id="diachi"></span></td>
    </tr>
  </table>

  <table style="margin-top:8px;">
    <thead>
      <tr>
        <th>Item</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody>
      <tr><td class="left">The Rent</td><td class="right" id="giaPhong"></td></tr>
      <tr><td class="left">Electricity</td><td class="right" id="dien"></td></tr>
      <tr><td class="left">Water</td><td class="right" id="nuoc"></td></tr>
      <tr><td class="left">Internet</td><td class="right" id="internet"></td></tr>
      <tr><td class="left">Garbage</td><td class="right" id="rac"></td></tr>
      <tr><td class="left">Parking</td><td class="right" id="xe"></td></tr>
      <tr><td class="left">Other</td><td class="right" id="khac"></td></tr>
      <tr class="total"><td class="right">TOTAL</td><td class="right" id="tong"></td></tr>
    </tbody>
  </table>

  <p><b>The total amount payable:</b> <span style="color:red;" id="tongThanhToan"></span> VNĐ</p>

  <table>
    <tr>
      <td class="left" colspan="3">
        <b>Transfer Information:</b><br>
        NAME ACCOUNT: <span id="tenTk"></span><br>
        NUMBER ACCOUNT: <span id="soTk"></span><br>
        Bank Name: <span id="nganHang"></span><br>
        <b>Transfer Content:</b><br>
        <span id="noiDung" class="highlight"></span>
      </td>
      <td style="width:140px; text-align:center;">
        <img id="qrcode" style="width:120px; height:120px;">
      </td>
    </tr>
  </table>

  <p class="note">IMPORTANT: Using the correct content of the message if it is wrong, it will be considered as not collecting money yet - QUAN TRỌNG: Sử dụng đúng nội dung tin nhắn nếu sai coi như chưa thu tiền.</p>

  <div class="sign-block">
    <div class="sign-col">
      <b>Khách hàng</b><br>(Ký và ghi rõ họ tên)
    </div>
    <div class="sign-col">
      <b>Người thu tiền</b><br>(Ký và ghi rõ họ tên)
    </div>
  </div>

  <script>
    // Hàm tạo QR bằng Google Chart
    function makeQR(text) {
      return "https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=" + encodeURIComponent(text);
    }

    // ===== DỮ LIỆU MẪU (lấy từ AppSheet CONCATENATE) =====
    // Giá phòng_a_Điện_a_Nước_a_Internet_a_Rác_a_Xe_a_Khác_a_Tổng
    const chuoiDichVu = "19000000_a_2652000_a_500000_a_300000_a_100000_a_200000_a_0_a_22152000";

    const arr = chuoiDichVu.split("_a_");

    // Thông tin khách
    const hoTen = "EMMA MARGARET POOK";
    const sdt = "0856.162.134";
    const diaChi = "122 No, Tu Hoa, Quang An, Tay Ho.";
    const tenTk = "VU VAN TOAN";
    const soTk = "628630686888";
    const nganHang = "Techcombank";
    const noiDung = "122.TUHOA.503 TT BILL TH 9";

    // Gán dữ liệu khách
    document.getElementById("hoten").innerText = hoTen;
    document.getElementById("sdt").innerText = sdt;
    document.getElementById("diachi").innerText = diaChi;
    document.getElementById("tenTk").innerText = tenTk;
    document.getElementById("soTk").innerText = soTk;
    document.getElementById("nganHang").innerText = nganHang;
    document.getElementById("noiDung").innerText = noiDung;

    // Gán chi tiết dịch vụ
    document.getElementById("giaPhong").innerText = arr[0];
    document.getElementById("dien").innerText = arr[1];
    document.getElementById("nuoc").innerText = arr[2];
    document.getElementById("internet").innerText = arr[3];
    document.getElementById("rac").innerText = arr[4];
    document.getElementById("xe").innerText = arr[5];
    document.getElementById("khac").innerText = arr[6];
    document.getElementById("tong").innerText = arr[7];
    document.getElementById("tongThanhToan").innerText = arr[7];

    // Ngày hiện tại
    const today = new Date();
    document.getElementById("ngay").innerText =
      String(today.getDate()).padStart(2,'0') + "/" +
      String(today.getMonth()+1).padStart(2,'0') + "/" +
      today.getFullYear();

    // Sinh QR code
    const qrData = `BANK:${nganHang}\nACC:${soTk}\nND:${noiDung}\nAMOUNT:${arr[7]}`;
    document.getElementById("qrcode").src = makeQR(qrData);
  </script>
</body>
</html>
