<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Biên lai thanh toán phòng</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .invoice-box {
      max-width: 900px;
      margin: auto;
      border: 1px solid #000;
      padding: 20px;
      font-size: 14px;
      line-height: 22px;
    }
    h2 { text-align: center; margin-bottom: 10px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
    table th, table td {
      border: 1px solid #000;
      padding: 6px;
      text-align: center;
    }
    table th { background: #f2f2f2; }
    .right { text-align: right; }
    .total {
      font-weight: bold;
      font-size: 16px;
      text-align: right;
    }
    .qr { text-align: center; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="invoice-box">
    <h2>BIÊN LAI THANH TOÁN PHÒNG</h2>

    <p><b>Họ tên khách:</b> <span id="hoten"></span></p>
    <p><b>Mã phòng:</b> <span id="maphong"></span></p>
    <p><b>Số tài khoản:</b> <span id="sotaikhoan"></span></p>

    <h3>Chi tiết dịch vụ</h3>
    <table id="services">
      <thead>
        <tr>
          <th>Dịch vụ</th>
          <th>Số lượng</th>
          <th>Đơn giá</th>
          <th>Thành tiền</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h3>Điện</h3>
    <table id="dien">
      <thead>
        <tr>
          <th>Chỉ số cũ</th>
          <th>Chỉ số mới</th>
          <th>Số tiêu thụ</th>
          <th>Đơn giá</th>
          <th>Thành tiền</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h3>Nước</h3>
    <table id="nuoc">
      <thead>
        <tr>
          <th>Chỉ số cũ</th>
          <th>Chỉ số mới</th>
          <th>Số tiêu thụ</th>
          <th>Đơn giá</th>
          <th>Thành tiền</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <p class="total">TỔNG CỘNG: <span id="tongcong"></span> VNĐ</p>

    <div class="qr">
      <h3>QR Thanh toán</h3>
      <img id="qrcode" alt="QR Code">
    </div>
  </div>

  <script>
    function getParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        hoten: params.get("hoten") || "Nguyễn Văn A",
        maphong: params.get("maphong") || "101",
        sotaikhoan: params.get("sotaikhoan") || "123456789",
        services: JSON.parse(params.get("services") || '[["Tiền phòng",1,2000000]]'),
        dien: JSON.parse(params.get("dien") || '[[100,150,5,3500]]'),
        nuoc: JSON.parse(params.get("nuoc") || '[[20,30,10,7000]]'),
        qrdata: params.get("qrdata") || "00020101021138560010A0000007270123000697041500015204381253037045802VN5907Nguyen Te6009Ho Chi Minh63041D0C"
      };
    }

    function formatCurrency(num) {
      return num.toLocaleString("vi-VN");
    }

    function render() {
      const p = getParams();
      document.getElementById("hoten").textContent = p.hoten;
      document.getElementById("maphong").textContent = p.maphong;
      document.getElementById("sotaikhoan").textContent = p.sotaikhoan;

      let tong = 0;

      // Services
      const sbody = document.querySelector("#services tbody");
      p.services.forEach(s => {
        const [name, qty, price] = s;
        const total = qty * price;
        tong += total;
        sbody.innerHTML += `<tr>
          <td>${name}</td>
          <td>${qty}</td>
          <td class="right">${formatCurrency(price)}</td>
          <td class="right">${formatCurrency(total)}</td>
        </tr>`;
      });

      // Điện
      const dbody = document.querySelector("#dien tbody");
      p.dien.forEach(d => {
        const [oldIndex, newIndex, used, price] = d;
        const total = used * price;
        tong += total;
        dbody.innerHTML += `<tr>
          <td>${oldIndex}</td>
          <td>${newIndex}</td>
          <td>${used}</td>
          <td class="right">${formatCurrency(price)}</td>
          <td class="right">${formatCurrency(total)}</td>
        </tr>`;
      });

      // Nước
      const nbody = document.querySelector("#nuoc tbody");
      p.nuoc.forEach(n => {
        const [oldIndex, newIndex, used, price] = n;
        const total = used * price;
        tong += total;
        nbody.innerHTML += `<tr>
          <td>${oldIndex}</td>
          <td>${newIndex}</td>
          <td>${used}</td>
          <td class="right">${formatCurrency(price)}</td>
          <td class="right">${formatCurrency(total)}</td>
        </tr>`;
      });

      document.getElementById("tongcong").textContent = formatCurrency(tong);

      // QR code
      document.getElementById("qrcode").src =
        "https://img.vietqr.io/image/970415-000000000001-compact2.png?amount=" + tong + "&addInfo=Thanh+toan+Phong+" + encodeURIComponent(p.maphong);
    }

    render();
  </script>
</body>
</html>
