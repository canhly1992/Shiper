<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Biên lai thanh toán phòng1</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .invoice-box { max-width: 900px; margin: auto; border: 1px solid #000; padding: 20px; font-size: 14px; line-height: 22px; }
    .header { text-align: center; margin-bottom: 20px; }
    .header h2 { margin: 0; }
    .info-table, .service-table, .utility-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
    .info-table td { padding: 3px 6px; }
    .service-table th, .service-table td, .utility-table th, .utility-table td { border: 1px solid #000; padding: 6px; text-align: center; }
    .service-table th, .utility-table th { background: #f0f0f0; }
    .total-box { border-top: 2px solid #000; font-weight: bold; text-align: right; padding: 8px; }
    .transfer-box { margin-top: 15px; font-size: 13px; line-height: 20px; }
    .transfer-box p { margin: 4px 0; }
    .highlight { background: yellow; font-weight: bold; padding: 2px 4px; }
    .qr-box { text-align: center; margin-top: 10px; }
    .footer { margin-top: 20px; text-align: right; font-style: italic; }
    .section-title { margin-top: 10px; font-weight: bold; text-decoration: underline; }
  </style>
</head>
<body>
  <div class="invoice-box">
    <!-- Header -->
    <div class="header">
      <h2>PHIẾU THU TIỀN PHÒNG</h2>
      <p>Địa chỉ: 122 Nơ Trang Long, Bình Thạnh, TP.HCM<br>
      Liên hệ: 0866.162.134 (Zalo/WhatsApp)</p>
    </div>

    <!-- Thông tin khách -->
    <table class="info-table">
      <tr>
        <td><b>Mã phòng:</b> <span id="maso"></span></td>
        <td><b>Thời gian:</b> <span id="thoigian"></span></td>
      </tr>
      <tr>
        <td><b>Họ tên:</b> <span id="hoten"></span></td>
        <td><b>Số điện thoại:</b> <span id="sdt"></span></td>
      </tr>
      <tr>
        <td><b>Tên TK:</b> <span id="tentaikhoan"></span></td>
        <td><b>Số TK:</b> <span id="sotaikhoan"></span></td>
      </tr>
      <tr>
        <td><b>Ngân hàng:</b> <span id="nganhang"></span></td>
        <td><b>Kỳ thanh toán:</b> <span id="kythanhtoan"></span></td>
      </tr>
    </table>

    <!-- Bảng dịch vụ khác -->
    <div class="section-title">Các dịch vụ khác</div>
    <table class="service-table">
      <thead>
        <tr>
          <th>Dịch vụ</th>
          <th>Số lượng</th>
          <th>Đơn giá</th>
          <th>Thành tiền</th>
          <th>Ghi chú</th>
        </tr>
      </thead>
      <tbody id="services"></tbody>
    </table>

    <!-- Bảng điện -->
    <div class="section-title">Tiền Điện</div>
    <table class="utility-table">
      <thead>
        <tr>
          <th>Dịch vụ</th>
          <th>Chỉ số cũ</th>
          <th>Chỉ số mới</th>
          <th>Số lượng (kWh)</th>
          <th>Đơn giá</th>
          <th>Thành tiền</th>
          <th>Ghi chú</th>
        </tr>
      </thead>
      <tbody id="dien"></tbody>
    </table>

    <!-- Bảng nước -->
    <div class="section-title">Tiền Nước</div>
    <table class="utility-table">
      <thead>
        <tr>
          <th>Dịch vụ</th>
          <th>Chỉ số cũ</th>
          <th>Chỉ số mới</th>
          <th>Số lượng (m³)</th>
          <th>Đơn giá</th>
          <th>Thành tiền</th>
          <th>Ghi chú</th>
        </tr>
      </thead>
      <tbody id="nuoc"></tbody>
    </table>

    <!-- Tổng cộng -->
    <div class="total-box">
      Tổng cộng: <span id="tongtien"></span> VND<br>
      Giảm giá: <span id="giagiam"></span> VND<br>
      Còn lại: <span id="conlai"></span> VND
    </div>

    <!-- Thông tin chuyển khoản -->
    <div class="transfer-box">
      <p><b>Thông tin chuyển khoản:</b></p>
      <p>Chủ tài khoản: <span id="tentaikhoan2"></span></p>
      <p>Số tài khoản: <b id="sotaikhoan2"></b></p>
      <p>Ngân hàng: <span id="nganhang2"></span></p>
      <p>Nội dung CK: <span class="highlight" id="noidungck"></span></p>
      <p style="color:red"><b>Lưu ý:</b> Vui lòng nhập đúng nội dung CK. Sai nội dung = chưa thanh toán.</p>
    </div>

    <!-- QR thanh toán -->
    <div class="qr-box">
      <img id="qrCode" src="" alt="QR Code">
    </div>

    <!-- Footer -->
    <div class="footer">
      Ngày <span id="ngay"></span><br>
      Người lập phiếu<br><br>
      <b>Vũ Cao Long</b>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);

    // Thông tin khách
    document.getElementById("maso").textContent = urlParams.get("maso") || "";
    document.getElementById("hoten").textContent = urlParams.get("hoten") || "";
    document.getElementById("sdt").textContent = urlParams.get("sdt") || "";
    document.getElementById("tentaikhoan").textContent = urlParams.get("tentaikhoan") || "";
    document.getElementById("sotaikhoan").textContent = urlParams.get("sotaikhoan") || "";
    document.getElementById("nganhang").textContent = urlParams.get("nganhang") || "";
    document.getElementById("kythanhtoan").textContent = urlParams.get("kythanhtoan") || "";

    // Tổng tiền
    document.getElementById("tongtien").textContent = urlParams.get("tongtien") || "0";
    document.getElementById("giagiam").textContent = urlParams.get("giagiam") || "0";
    document.getElementById("conlai").textContent = urlParams.get("conlai") || urlParams.get("tongtien") || "0";

    // Thông tin chuyển khoản
    document.getElementById("tentaikhoan2").textContent = urlParams.get("tentaikhoan") || "";
    document.getElementById("sotaikhoan2").textContent = urlParams.get("sotaikhoan") || "";
    document.getElementById("nganhang2").textContent = urlParams.get("nganhang") || "";

    // Nội dung CK mặc định: maso + kỳ thanh toán
    const maso = urlParams.get("maso") || "";
    const kythanhtoan = urlParams.get("kythanhtoan") || "";
    document.getElementById("noidungck").textContent = `${maso} TT BILL ${kythanhtoan}`;

    // Ngày lập phiếu
    const today = new Date();
    document.getElementById("thoigian").textContent = today.toLocaleDateString("vi-VN");
    document.getElementById("ngay").textContent = today.toLocaleDateString("vi-VN");

    // QR Code
    const qrData = window.location.href; 
    document.getElementById("qrCode").src =
      "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=" + encodeURIComponent(qrData);

    // Dịch vụ khác
    const servicesData = JSON.parse(urlParams.get("services") || "[]");
    const servicesTbody = document.getElementById("services");
    servicesData.forEach(s => {
      const quantity = s.quantity || 1;
      const total = s.total || (quantity * (s.price || 0));
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${s.name}</td>
        <td>${quantity}</td>
        <td>${s.price || 0}</td>
        <td>${total}</td>
        <td>${s.note || ""}</td>
      `;
      servicesTbody.appendChild(tr);
    });

    // Bảng điện
    const dienData = JSON.parse(urlParams.get("dien") || "[]");
    const dienTbody = document.getElementById("dien");
    dienData.forEach(d => {
      const tr = document.createElement("tr");
      const quantity = d.quantity || ((d.new || 0) - (d.old || 0));
      tr.innerHTML = `
        <td>${d.name}</td>
        <td>${d.old || 0}</td>
        <td>${d.new || 0}</td>
        <td>${quantity}</td>
        <td>${d.price || 0}</td>
        <td>${d.total || (quantity * (d.price || 0))}</td>
        <td>${d.note || ""}</td>
      `;
      dienTbody.appendChild(tr);
    });

    // Bảng nước
    const nuocData = JSON.parse(urlParams.get("nuoc") || "[]");
    const nuocTbody = document.getElementById("nuoc");
    nuocData.forEach(n => {
      const tr = document.createElement("tr");
      const quantity = n.quantity || ((n.new || 0) - (n.old || 0));
      tr.innerHTML = `
        <td>${n.name}</td>
        <td>${n.old || 0}</td>
        <td>${n.new || 0}</td>
        <td>${quantity}</td>
        <td>${n.price || 0}</td>
        <td>${n.total || (quantity * (n.price || 0))}</td>
        <td>${n.note || ""}</td>
      `;
      nuocTbody.appendChild(tr);
    });
  </script>
</body>
</html>
