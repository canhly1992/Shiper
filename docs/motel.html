<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Phiếu thu tiền phòng</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .invoice-box {
      max-width: 900px;
      margin: auto;
      border: 1px solid #000;
      padding: 20px;
      font-size: 14px;
      line-height: 20px;
    }
    h2 { text-align: center; margin: 5px 0; }
    .sub-header { text-align: center; margin: 0; font-size: 13px; }
    p { margin: 3px 0; }
    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px 20px;
      margin-top: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 14px;
    }
    table, th, td {
      border: 1px solid #000;
    }
    th, td {
      padding: 6px;
      text-align: center;
    }
    h3 { text-align: center; margin-top: 20px; }
    .summary { margin-top: 10px; text-align: right; }
    .footer {
      margin-top: 30px;
      display: flex;
      justify-content: space-between;
      font-size: 13px;
    }
    .footer .sign { text-align: center; width: 200px; }
    /* Bảng thông tin CK */
    .ck-table {
      width:100%;
      border-collapse:collapse;
      margin-top:12px;
    }
    .ck-table td {
      border:1px solid #000;
      padding:8px;
    }
    .ck-table td.label { width:25%; font-weight:600; background:#f7f7f7; text-align:left; }
    .ck-table td.value { width:45%; text-align:left; }
    .ck-table td.qr { width:30%; text-align:center; vertical-align:middle; }
    .ck-note { color:red; font-size:13px; margin-top:6px; }
  </style>
</head>
<body>
  <div class="invoice-box">
    <h2>PHIẾU THU TIỀN PHÒNG</h2>
    <p class="sub-header">Địa chỉ: <span id="diachi"></span></p>
    <p class="sub-header">Liên hệ: <span id="sdtchothue"></span> (Zalo/WhatsApp)</p>

    <div class="info-grid">
      <p><strong>Mã phiếu:</strong> <span id="maphieu"></span></p>
      <p><strong>Ngày lập:</strong> <span id="ngaylap"></span></p>
      <p><strong>Mã phòng:</strong> <span id="maso"></span></p>
      <p><strong>Họ tên:</strong> <span id="hoten"></span></p>
      <p><strong>Kỳ thanh toán:</strong> <span id="kythanhtoan"></span></p>
      <p><strong>CCCD/Passport:</strong> <span id="cccd"></span></p>
      <p><strong>Số điện thoại khách thuê:</strong> <span id="sdt"></span></p>
    </div>

    <!-- Dịch vụ khác -->
    <h3>Các dịch vụ khác</h3>
    <table>
      <tr>
        <th>Dịch vụ</th><th>Số lượng</th><th>Đơn giá</th><th>Thành tiền</th>
      </tr>
      <tr><td class="left">Tổng tiền phòng</td><td>1</td><td id="tongtienphong_unit">0</td><td id="tongtienphong_total">0</td></tr>
      <tr><td>Internet</td><td>1</td><td id="tieninternet">0</td><td id="thanhtieninternet">0</td></tr>
      <tr><td>Phí rác</td><td>1</td><td id="rac">0</td><td id="thanhtienrac">0</td></tr>
      <tr><td>Gửi xe</td><td id="soluongxe">0</td><td id="phixe">0</td><td id="tongphixe">0</td></tr>
      <tr><td>Chi phí khác</td><td>1</td><td id="chiphipkhac">0</td><td id="thanhtienkhac">0</td></tr>
    </table>

    <!-- Tiền điện -->
    <h3>Tiền điện</h3>
    <table>
      <tr>
        <th>Dịch vụ</th><th>Chỉ số cũ</th><th>Chỉ số mới</th><th>Số lượng (kWh)</th><th>Đơn giá</th><th>Thành tiền</th>
      </tr>
      <tr>
        <td>Điện</td>
        <td id="sodiencu"></td>
        <td id="sodienmoi"></td>
        <td id="sodienluong"></td>
        <td id="giadien"></td>
        <td id="tongtiendien"></td>
      </tr>
    </table>

    <!-- Tiền nước -->
    <h3>Tiền nước</h3>
    <table>
      <tr>
        <th>Dịch vụ</th><th>Chỉ số cũ</th><th>Chỉ số mới</th><th>Số lượng (m³)</th><th>Đơn giá</th><th>Thành tiền</th>
      </tr>
      <tr>
        <td>Nước</td>
        <td id="sonuoccu"></td>
        <td id="sonuocmoi"></td>
        <td id="sonuocluong"></td>
        <td id="gianuoc"></td>
        <td id="tongtiennuoc"></td>
      </tr>
    </table>

    <!-- Tổng hợp -->
    <div class="summary">
      <p><strong>Tổng cộng:</strong> <span id="tongtien"></span> VND</p>
      <p><strong>Giảm giá:</strong> <span id="giagiam"></span> VND</p>
      <p><strong>Còn lại:</strong> <span id="conlai"></span> VND</p>
    </div>

    <!-- Thông tin CK -->
    <h3 style="margin-top:18px;">Thông tin chuyển khoản</h3>
    <table class="ck-table">
      <tr>
        <td class="label">Chủ tài khoản</td>
        <td class="value" id="tentaikhoan">NGUYEN CANH LY</td>
        <td class="qr" rowspan="4"><img id="vietqr" src="" alt="QR Thanh toán" width="160" height="160"></td>
      </tr>
      <tr>
        <td class="label">Số tài khoản</td>
        <td class="value" id="sotaikhoan">007933227</td>
      </tr>
      <tr>
        <td class="label">Ngân hàng</td>
        <td class="value" id="nganhang">VIB</td>
      </tr>
      <tr>
        <td class="label">Nội dung CK</td>
        <td class="value" id="noidungck">TT BILL 122.TUHOA.503 TH 9</td>
      </tr>
    </table>
    <p class="ck-note"><em>Lưu ý: Vui lòng nhập đúng <strong>Nội dung CK</strong>. Sai nội dung = chưa thanh toán.</em></p>

    <div class="footer">
      <div></div>
      <div class="sign">
        <p>Ngày <span id="ngaylap2"></span></p>
        <p><em>Người lập phiếu</em></p>
        <br><br>
        <p><strong>Vũ Cao Long</strong></p>
      </div>
    </div>
  </div>

  <script>
    function getParam(param) {
      return new URLSearchParams(window.location.search).get(param) || "";
    }
    function formatNumber(num) {
      const n = Number(num) || 0;
      return n.toLocaleString('vi-VN');
    }

    // Header
    document.getElementById("diachi").innerText = getParam("diachi");
    document.getElementById("sdtchothue").innerText = getParam("sdtchothue");

    // Ngày lập
    const ngaylap = getParam("ngaylap");
    document.getElementById("ngaylap").innerText = ngaylap;
    document.getElementById("ngaylap2").innerText = ngaylap;

    // Thông tin cơ bản
    ["maphieu","maso","hoten","cccd","sdt","kythanhtoan"].forEach(id=>{
      if(document.getElementById(id)) document.getElementById(id).innerText = getParam(id);
    });

    // Tiền phòng
    const tongtienphong = Number(getParam("tongtienphong")) || 0;
    document.getElementById("tongtienphong_unit").innerText = formatNumber(tongtienphong);
    document.getElementById("tongtienphong_total").innerText = formatNumber(tongtienphong);

    // Dịch vụ khác
    const tieninternet = Number(getParam("tieninternet")) || 0;
    document.getElementById("tieninternet").innerText = formatNumber(tieninternet);
    document.getElementById("thanhtieninternet").innerText = formatNumber(tieninternet);

    const rac = Number(getParam("rac")) || 0;
    document.getElementById("rac").innerText = formatNumber(rac);
    document.getElementById("thanhtienrac").innerText = formatNumber(rac);

    const soluongxe = Number(getParam("soluongxe")) || 0;
    const phixe = Number(getParam("phixe")) || 0;
    document.getElementById("soluongxe").innerText = soluongxe;
    document.getElementById("phixe").innerText = formatNumber(phixe);
    document.getElementById("tongphixe").innerText = formatNumber(soluongxe * phixe);

    const chiphipkhac = Number(getParam("chiphipkhac")) || 0;
    document.getElementById("chiphipkhac").innerText = formatNumber(chiphipkhac);
    document.getElementById("thanhtienkhac").innerText = formatNumber(chiphipkhac);

    // Điện
    const diencu = Number(getParam("sodiencu")) || 0;
    const dienmoi = Number(getParam("sodienmoi")) || 0;
    const giadien = Number(getParam("giadien")) || 0;
    const sodienluong = Math.max(0, dienmoi - diencu);
    document.getElementById("sodiencu").innerText = diencu;
    document.getElementById("sodienmoi").innerText = dienmoi;
    document.getElementById("sodienluong").innerText = sodienluong;
    document.getElementById("giadien").innerText = formatNumber(giadien);
    document.getElementById("tongtiendien").innerText = formatNumber(sodienluong * giadien);

    // Nước
    const nuoccu = Number(getParam("sonuoccu")) || 0;
    const nuocmoi = Number(getParam("sonuocmoi")) || 0;
    const gianuoc = Number(getParam("gianuoc")) || 0;
    const sonuocluong = Math.max(0, nuocmoi - nuoccu);
    document.getElementById("sonuoccu").innerText = nuoccu;
    document.getElementById("sonuocmoi").innerText = nuocmoi;
    document.getElementById("sonuocluong").innerText = sonuocluong;
    document.getElementById("gianuoc").innerText = formatNumber(gianuoc);
    document.getElementById("tongtiennuoc").innerText = formatNumber(sonuocluong * gianuoc);

    // Tổng cộng
    const tongtien = tongtienphong + tieninternet + rac + (soluongxe * phixe) + chiphipkhac + (sodienluong * giadien) + (sonuocluong * gianuoc);
    document.getElementById("tongtien").innerText = formatNumber(tongtien);

    // Giảm giá + còn lại
    const giagiam = Number(getParam("giagiam")) || 0;
    const conlai = tongtien - giagiam;
    document.getElementById("giagiam").innerText = formatNumber(giagiam);
    document.getElementById("conlai").innerText = formatNumber(conlai);

    // Thông tin CK
    const tentaikhoan = getParam("tentaikhoan") || "";
    const sotaikhoan = getParam("sotaikhoan") || "";
    const nganhang = getParam("nganhang") || "";

    document.getElementById("tentaikhoan").innerText = tentaikhoan;
    document.getElementById("sotaikhoan").innerText = sotaikhoan;
    document.getElementById("nganhang").innerText = nganhang;

    // Nội dung CK: <Mã phiếu>.<Mã phòng> TT BILL TH <Kỳ thanh toán>
    const map = getParam("maphieu") || "";
    const room = getParam("maso") || "";
    const kyth = getParam("kythanhtoan") || "";
    const noidung = `${map}.${room} TT BILL TH ${kyth}`.trim();
    document.getElementById("noidungck").innerText = noidung;

    // QR code
    const bankForQr = nganhang.toLowerCase();
    const qrUrl = `https://img.vietqr.io/image/${bankForQr}-${sotaikhoan}-compact2.png?amount=${conlai}&addInfo=${encodeURIComponent(noidung)}&accountName=${encodeURIComponent(tentaikhoan)}`;
    document.getElementById("vietqr").src = qrUrl;
  </script>
</body>
</html>
