<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Biên lai thanh toán phòng</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.5; }
    .invoice-box {
      max-width: 900px;
      margin: auto;
      border: 1px solid #000;
      padding: 20px;
      font-size: 14px;
    }
    h2 { text-align: center; margin-bottom: 10px; }
    .header, .footer { text-align: center; margin-bottom: 10px; }
    .row { display: flex; justify-content: space-between; margin-bottom: 5px; }
    .table {
      width: 100%; border-collapse: collapse; margin-bottom: 20px;
    }
    .table th, .table td {
      border: 1px solid #000; padding: 6px; text-align: center;
    }
    .right { text-align: right; }
    .center { text-align: center; }
    .total { font-weight: bold; }
  </style>
</head>
<body>
  <div class="invoice-box">
    <h2>BIÊN LAI THANH TOÁN PHÒNG TRỌ</h2>

    <div class="row center">
      <span id="maphieu"></span> | <span id="ngaylap"></span>
    </div>

    <div class="row">
      <div><b>Mã phòng:</b> <span id="maso"></span></div>
      <div><b>Kỳ thanh toán:</b> <span id="kythanhtoan"></span></div>
    </div>

    <div class="row">
      <div><b>Họ tên:</b> <span id="hoten"></span></div>
      <div><b>CCCD/Passport:</b> <span id="cccd"></span></div>
    </div>

    <div class="row">
      <div><b>Số điện thoại khách thuê:</b> <span id="sdt"></span></div>
    </div>

    <h3>I. Điện - Nước</h3>
    <table class="table">
      <tr>
        <th>Dịch vụ</th>
        <th>Chỉ số cũ</th>
        <th>Chỉ số mới</th>
        <th>Tiêu thụ</th>
        <th>Đơn giá</th>
        <th>Thành tiền</th>
      </tr>
      <tr>
        <td>Điện</td>
        <td id="sodiencu"></td>
        <td id="sodienmoi"></td>
        <td id="dien_sd"></td>
        <td id="giadien"></td>
        <td id="tiendien"></td>
      </tr>
      <tr>
        <td>Nước</td>
        <td id="sonuoccu"></td>
        <td id="sonuocmoi"></td>
        <td id="nuoc_sd"></td>
        <td id="gianuoc"></td>
        <td id="tiennuoc"></td>
      </tr>
    </table>

    <h3>II. Dịch vụ khác</h3>
    <table class="table">
      <tr>
        <th>Dịch vụ</th>
        <th>Số lượng</th>
        <th>Đơn giá</th>
        <th>Thành tiền</th>
      </tr>
      <tr>
        <td>Internet</td>
        <td>1</td>
        <td id="tieninternet"></td>
        <td id="tieninternet"></td>
      </tr>
      <tr>
        <td>Rác</td>
        <td>1</td>
        <td id="rac"></td>
        <td id="rac"></td>
      </tr>
      <tr>
        <td>Xe</td>
        <td id="soluongxe"></td>
        <td id="phixe"></td>
        <td id="tienxe"></td>
      </tr>
      <tr>
        <td>Chi phí khác</td>
        <td>1</td>
        <td id="chiphipkhac"></td>
        <td id="chiphipkhac"></td>
      </tr>
    </table>

    <h3>III. Tổng cộng</h3>
    <table class="table">
      <tr>
        <td class="right">Tổng dịch vụ:</td>
        <td id="tongcong"></td>
      </tr>
      <tr>
        <td class="right">Giảm giá:</td>
        <td id="giagiam"></td>
      </tr>
      <tr class="total">
        <td class="right">Còn lại phải trả:</td>
        <td id="conlai"></td>
      </tr>
    </table>

    <h3>IV. Chuyển khoản</h3>
    <p><b>Số tài khoản:</b> <span id="sotaikhoan"></span></p>
    <p><b>Chủ tài khoản:</b> <span id="tentaikhoan"></span></p>
    <p><b>Ngân hàng:</b> <span id="nganhang"></span></p>
    <p><b>Nội dung CK:</b> <span id="noidungck"></span></p>
    <div class="center">
      <img id="vietqr" src="" alt="VietQR" style="max-width:250px; margin-top:10px;">
    </div>

    <div class="footer">
      <p><b>Địa chỉ:</b> <span id="diachi"></span></p>
      <p><b>Liên hệ:</b> <span id="lienhe"></span></p>
    </div>
  </div>

  <script>
    function getParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param) || '';
    }

    function setValue(id, value) {
      document.getElementById(id).innerText = value;
    }

    window.onload = function() {
      // Gán dữ liệu cơ bản
      setValue("maphieu", "Mã phiếu: " + getParam("maphieu"));
      setValue("ngaylap", "Ngày lập: " + getParam("ngaylap"));
      setValue("maso", getParam("maso"));
      setValue("kythanhtoan", getParam("kythanhtoan"));
      setValue("hoten", getParam("hoten"));
      setValue("cccd", getParam("cccd"));
      setValue("sdt", getParam("sdt"));

      setValue("sotaikhoan", getParam("sotaikhoan"));
      setValue("tentaikhoan", getParam("tentaikhoan"));
      setValue("nganhang", getParam("nganhang"));

      setValue("sodiencu", getParam("sodiencu"));
      setValue("sodienmoi", getParam("sodienmoi"));
      setValue("giadien", getParam("giadien"));

      setValue("sonuoccu", getParam("sonuoccu"));
      setValue("sonuocmoi", getParam("sonuocmoi"));
      setValue("gianuoc", getParam("gianuoc"));

      setValue("tieninternet", getParam("tieninternet"));
      setValue("rac", getParam("rac"));
      setValue("soluongxe", getParam("soluongxe"));
      setValue("phixe", getParam("phixe"));
      setValue("chiphipkhac", getParam("chiphipkhac"));

      setValue("giagiam", getParam("giagiam"));
      setValue("diachi", getParam("diachi"));
      setValue("lienhe", getParam("lienhe"));

      // Tính toán điện, nước
      let dien_sd = getParam("sodienmoi") - getParam("sodiencu");
      let tiendien = dien_sd * getParam("giadien");
      setValue("dien_sd", dien_sd);
      setValue("tiendien", tiendien);

      let nuoc_sd = getParam("sonuocmoi") - getParam("sonuoccu");
      let tiennuoc = nuoc_sd * getParam("gianuoc");
      setValue("nuoc_sd", nuoc_sd);
      setValue("tiennuoc", tiennuoc);

      // Tính tiền xe
      let tienxe = getParam("soluongxe") * getParam("phixe");
      setValue("tienxe", tienxe);

      // Tổng cộng
      let tongcong = tiendien + tiennuoc + Number(getParam("tieninternet")) + Number(getParam("rac")) + Number(tienxe) + Number(getParam("chiphipkhac"));
      setValue("tongcong", tongcong);

      let conlai = tongcong - Number(getParam("giagiam"));
      setValue("conlai", conlai);

      // Nội dung CK: Mã phiếu.Mã phòng TT BILL TH Kỳ
      let noidung = `${getParam("maphieu")}.${getParam("maso")} TT BILL TH ${getParam("kythanhtoan")}`;
      setValue("noidungck", noidung);

      // QR Code VietQR
      const qrUrl = `https://img.vietqr.io/image/vietinbank-007933227-compact2.png?amount=${conlai}&addInfo=${encodeURIComponent(noidung)}&accountName=${encodeURIComponent(getParam("tentaikhoan"))}`;
      document.getElementById("vietqr").src = qrUrl;
    }
  </script>
</body>
</html>
