<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Phi·∫øu B√°n H√†ng</title>
  <style>
    @page { size: A5 portrait; margin: 10mm; }
    body { font-family: "Times New Roman", serif; font-size:12px; margin:0; padding:10mm; color:#000; }
    .header, .footer { text-align:center; }
    h3 { margin:4px 0; }
    table { width:100%; border-collapse:collapse; margin-top:6px; font-size:11px; }
    table, th, td { border:1px solid #000; }
    th, td { padding:4px; text-align:center; }
    .left { text-align:left; }
    .sign { display:flex; justify-content:space-between; margin-top:16px; font-size:11px; }
    .totals { margin-top:6px; }
    .totals p { margin:2px 0; }
    .btn-print { position:fixed; top:5px; right:5px; padding:4px 8px; font-size:12px; }
  </style>
</head>
<body>

  <button class="btn-print" onclick="window.print()">üñ® In</button>

  <div class="header">
    <div><strong>3H OPTICAL</strong></div>
    <div>314 Nguy·ªÖn Th∆∞·ª£ng Hi·ªÅn, P.5, Q. Ph√∫ Nhu·∫≠n, TP.HCM</div>
    <div>ƒêT: 756000</div>
    <h3>PHI·∫æU B√ÅN H√ÄNG</h3>
  </div>

  <table>
    <thead>
      <tr>
        <th class="left">T√™n d·ªãch v·ª•</th>
        <th>SL</th>
        <th>ƒê∆°n gi√°</th>
        <th>Chi·∫øt kh·∫•u</th>
        <th>T·ªïng ti·ªÅn</th>
      </tr>
    </thead>
    <tbody id="service-rows"></tbody>
  </table>

  <div class="totals">
    <p><strong>T·ªïng ti·ªÅn:</strong> <span id="total-display"></span></p>
    <p><strong>T·∫°m ·ª©ng:</strong> <span id="tt1-display"></span></p>
    <p><strong>C·∫ßn thanh to√°n:</strong> <span id="canthanhtoan-display"></span></p>
  </div>

  <div class="sign">
    <div>Ng∆∞·ªùi n·ªôp ti·ªÅn<br>(K√Ω v√† ghi r√µ h·ªç t√™n)</div>
    <div><span id="thoigian"></span><br>Ng∆∞·ªùi thu ti·ªÅn<br>(K√Ω v√† ghi r√µ h·ªç t√™n)</div>
  </div>

  <script>
    function getParam(name){
      return decodeURIComponent(new URLSearchParams(location.search).get(name) || '');
    }

    function numberFormat(str) {
      if(!str) return '';
      return Intl.NumberFormat('vi-VN', { style:'decimal' }).format(parseFloat(str)) + ' ƒë';
    }

    function formatDateShort() {
      const d = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Ho_Chi_Minh" }));
      return `TP. H·ªì Ch√≠ Minh, ng√†y ${String(d.getDate()).padStart(2,'0')} th√°ng ${String(d.getMonth()+1).padStart(2,'0')} nƒÉm ${d.getFullYear()}`;
    }

    window.onload = function(){
      document.getElementById("thoigian").innerText = formatDateShort();

      const dataRaw = getParam("data");
      const rows = dataRaw.split("_b_").map(x=>x.split("_a_"));
      const tbody = document.getElementById("service-rows");

      rows.forEach(r => {
        const tr = document.createElement("tr");
        const [ten, sl, dongia, chietkhau, thanhtien] = r;
        tr.innerHTML = `
          <td class="left">${ten}</td>
          <td>${sl}</td>
          <td>${numberFormat(dongia)}</td>
          <td>${numberFormat(chietkhau)}</td>
          <td>${numberFormat(thanhtien)}</td>`;
        tbody.appendChild(tr);
      });

      document.getElementById("total-display").innerText = numberFormat(getParam("tong"));
      document.getElementById("tt1-display").innerText = numberFormat(getParam("tt1"));
      document.getElementById("canthanhtoan-display").innerText = numberFormat(getParam("canthanhtoan"));
    };
  </script>

</body>
</html>
