<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Phiếu Bảo Hành</title>
  <style>
    body {
      font-family: 'Times New Roman', serif;
      font-size: 12px;
      padding: 10px;
      max-width: 100mm;
      margin: auto;
    }
    .center {
      text-align: center;
      margin: 10px 0;
    }
    .bold {
      font-weight: bold;
    }
    .section {
      margin-top: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 5px;
    }
    th, td {
      border: 1px solid #000;
      padding: 4px;
      font-size: 11px;
    }
    th {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>

  <div class="center bold">PHIẾU BẢO HÀNH SẢN PHẨM</div>
  <div class="center" id="thoigian"></div> <!-- nơi hiển thị thời gian -->

  <div class="section">
    <strong>Tên khách hàng:</strong> <span id="tenkhach"></span><br>
    <strong>Số điện thoại:</strong> <span id="sdt"></span><br>
    <strong>Địa chỉ:</strong> <span id="diachi"></span>
  </div>

  <div class="section">
    <strong>Sản phẩm bảo hành:</strong>
    <table>
      <thead>
        <tr>
          <th>STT</th>
          <th>Tên SP</th>
          <th>Số lượng</th>
          <th>Tình trạng</th>
        </tr>
      </thead>
      <tbody id="product-rows">
        <!-- Dữ liệu sẽ được render tại đây -->
      </tbody>
    </table>
  </div>

  <div class="section">
    <strong>Ghi chú:</strong> <span id="ghichu"></span>
  </div>

  <script>
    function getParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name) || "";
    }

    function formatVNTime() {
      const now = new Date();
      now.setHours(now.getHours() + 7 - now.getTimezoneOffset() / 60); // UTC+7

      const ngay = String(now.getDate()).padStart(2, '0');
      const thang = String(now.getMonth() + 1).padStart(2, '0');
      const nam = now.getFullYear();
      const gio = String(now.getHours()).padStart(2, '0');
      const phut = String(now.getMinutes()).padStart(2, '0');
      const giay = String(now.getSeconds()).padStart(2, '0');

      return `Ngày ${ngay} tháng ${thang} năm ${nam} lúc ${gio} giờ ${phut} phút ${giay} giây`;
    }

    window.onload = function () {
      // Hiển thị thời gian hiện tại
      document.getElementById("thoigian").innerText = formatVNTime();

      // Hiển thị thông tin
      document.getElementById("tenkhach").innerText = getParam("tenkhach");
      document.getElementById("sdt").innerText = getParam("sdt");
      document.getElementById("diachi").innerText = getParam("diachi");
      document.getElementById("ghichu").innerText = getParam("ghichu");

      // Render sản phẩm bảo hành
      const data = getParam("sanpham"); // dạng: Tên1_a_SL1_a_TT1_b_Tên2_a_SL2_a_TT2...
      if (data) {
        const items = data.split("_b_");
        const html = items.map((item, index) => {
          const [ten, sl, tinhtrang] = item.split("_a_");
          return `<tr>
                    <td style="text-align:center">${index + 1}</td>
                    <td>${ten}</td>
                    <td style="text-align:center">${sl}</td>
                    <td>${tinhtrang}</td>
                  </tr>`;
        }).join("");
        document.getElementById("product-rows").innerHTML = html;
      }
    };
  </script>

</body>
</html>
